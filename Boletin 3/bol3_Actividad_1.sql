--4º ACTIVIDAD:
DROP TABLE BARCOS CASCADE CONSTRAINT;
DROP TABLE ESPECIE CASCADE CONSTRAINT;
DROP TABLE LOTES CASCADE CONSTRAINT;
DROP TABLE CALADERO CASCADE CONSTRAINT;
DROP TABLE FECHAS_CAPTURAS_PERMITIDAS CASCADE CONSTRAINT;


CREATE TABLE BARCOS
(
    MATRICULA VARCHAR2 (20),
    NOMBRE VARCHAR2 (20),
    CLASE VARCHAR2 (20),
    ARMADOR VARCHAR2 (30),
    CAPACIDAD NUMBER (20),
    NACIONALIDAD VARCHAR2 (20),
    CONSTRAINT PK_BARCOS PRIMARY KEY (MATRICULA),
    CONSTRAINT CHK_MATRICULA CHECK (REGEXP_LIKE(MATRICULA,'^[A-Z]{2}-[0-9]{4}$'))
);

CREATE TABLE ESPECIE(
    CODIGO NUMBER (20),
    NOMBRE VARCHAR2 (20),
    TIPO VARCHAR2 (20),
    CUPO_POR_BARCO NUMBER (20),
    CALADERO_PRINCIPAL NUMBER (20),
    CONSTRAINT PK_ESPECIE PRIMARY KEY (CODIGO)
);

CREATE TABLE LOTES
(
    CODIGO NUMBER (20),
    MATRICULA VARCHAR2 (20),
    NUM_KILOS NUMBER (20),
    PRECIO_POR_KILO_SALIDA NUMBER (20),
    PRECIO_POR_KILO_JUDICADO NUMBER (20),
    FECHA_VENTA DATE NOT NULL,
    COD_ESPECIE NUMBER (20),
    CONSTRAINT PK_LOTES PRIMARY KEY (CODIGO),
    CONSTRAINT FK_LOTES FOREIGN KEY (MATRICULA) REFERENCES BARCOS(MATRICULA) ON DELETE CASCADE,
    CONSTRAINT FK2_LOTES FOREIGN KEY (COD_ESPECIE) REFERENCES ESPECIE(CODIGO) ON DELETE CASCADE,
    CONSTRAINT CHK_NUM_KILOS CHECK (NUM_KILOS > 0),
    CONSTRAINT CHK_PRECIO_POR_KILO_JUDICADO CHECK (PRECIO_POR_KILO_JUDICADO > 0),
    CONSTRAINT CHK_PRECIO_POR_KILO_SALIDA CHECK (PRECIO_POR_KILO_SALIDA > 0),
    CONSTRAINT CHK_PRECIO_MAYOR CHECK (PRECIO_POR_KILO_JUDICADO > PRECIO_POR_KILO_SALIDA)
);

CREATE TABLE CALADERO(
    CODIGO NUMBER (20),
    NOMBRE VARCHAR2 (20),
    UBICACION VARCHAR2 (20),
    ESPECIE_PRINCIPAL NUMBER (20),
    CONSTRAINT PK_CALADERO PRIMARY KEY (CODIGO),
    CONSTRAINT FK_CALADERO FOREIGN KEY (ESPECIE_PRINCIPAL) REFERENCES ESPECIE(CODIGO) ON DELETE SET NULL,
    CONSTRAINT CHK_NOMBRE_UPPER CHECK (NOMBRE = UPPER(NOMBRE)),
    CONSTRAINT CHK_UBICACION_UPPER CHECK (UBICACION = UPPER(UBICACION))
);

CREATE TABLE FECHAS_CAPTURAS_PERMITIDAS
(
    COD_ESPECIE NUMBER (20),
    COD_CALADERO NUMBER (20),
    FECHA_INICIAL DATE,
    FECHA_FINAL DATE,
    CONSTRAINT PK_FECHAS_CAPTURAS_PERMITIDAS PRIMARY KEY (COD_ESPECIE, COD_CALADERO),
    CONSTRAINT FK_FECHAS_CAPTURAS_PERMITIDAS FOREIGN KEY (COD_ESPECIE) REFERENCES ESPECIE(CODIGO),
    CONSTRAINT FK2_FECHAS_CAPTURAS_PERMITIDAS FOREIGN KEY (COD_CALADERO) REFERENCES CALADERO(CODIGO),
    CONSTRAINT CHK_FECHAS_PROHIBIDAS CHECK (NOT (TO_CHAR(FECHA_INICIAL,'MMDD') <= '0328' AND TO_CHAR(FECHA_FINAL,'MMDD') >= '0202'))
);


ALTER TABLE ESPECIE ADD CONSTRAINT FK_ESPECIE FOREIGN KEY (CALADERO_PRINCIPAL) REFERENCES CALADERO(CODIGO);


--1º ACTIVIDAD:
ALTER TABLE CALADERO ADD (NOMBRE_CIENTIFICO VARCHAR2 (20));


--2º ACTIVIDAD:
INSERT INTO BARCOS VALUES ('AB-1234','BARCO1','PESQUERO','JUAN',100,'ESPAÑA');
INSERT INTO BARCOS VALUES ('CD-5678','BARCO2','CARGUERO','PEDRO',200,'PORTUGAL');

INSERT INTO CALADERO VALUES (1,'ATLANTICO','SEVILLA',NULL,'ATLANTICO');
INSERT INTO CALADERO VALUES (2,'MEDITERRANEO','MALAGA',NULL,'MEDITERRANEO');

INSERT INTO ESPECIE VALUES (10,'ATUN','MARINO',50,1);
INSERT INTO ESPECIE VALUES (20,'MERLUZA','MARINO',30,2);

INSERT INTO LOTES VALUES (100,'AB-1234',500,10,12,DATE '2025-01-15',10);
INSERT INTO LOTES VALUES (200,'CD-5678',300,8,9,DATE '2025-01-20',20);

INSERT INTO FECHAS_CAPTURAS_PERMITIDAS VALUES (10,1,DATE '2025-04-01',DATE '2025-06-30');
INSERT INTO FECHAS_CAPTURAS_PERMITIDAS VALUES (20,2,DATE '2025-07-01',DATE '2025-09-30');


--3º ACTIVIDAD:
ALTER TABLE BARCOS DROP COLUMN ARMADOR;

